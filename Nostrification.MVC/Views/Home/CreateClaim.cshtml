@model Nostrification.Domain.Entities.Claim
@{
    ViewBag.Title = "Ariza yuborish";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<h2>Ariza yuborish</h2>

@if (TempData["Success"] != null)
{
    <div class="alert alert-success">@TempData["Success"]</div>
}

@if (TempData["Error"] != null)
{
    <div class="alert alert-danger">@TempData["Error"]</div>
}

@using (Html.BeginForm("CreateClaim", "Home", FormMethod.Post, new { enctype = "multipart/form-data" }))
{
    <div class="card">
        <div class="card-header bg-primary text-white">
            <h5>Murojaat qiluvchi shaxs to'g'risida ma'lumot</h5>
        </div>
        <div class="card-body">
            <div class="form-group">
                <label>Talabgorga aloqaligi <span class="text-danger">*</span></label>
                <select class="form-control" name="ClaimerTypeId" id="ClaimerTypeId" required>
                    <option value="">Tanlang</option>
                    <option value="1">Ota-onasi</option>
                    <option value="2">Vasiy</option>
                    <option value="3">Notarial ishonchnoma berilgan shaxs</option>
                    <option value="4">O'zi</option>
                </select>
            </div>

            <div class="form-group" id="parentNameGroup" style="display:none;">
                <label>Murojaat qiluvchining F.I.SH.</label>
                <input type="text" class="form-control" name="ParentName" />
            </div>
        </div>
    </div>

    <div class="card mt-3">
        <div class="card-header bg-primary text-white">
            <h5>Talabgor to'g'risida ma'lumot</h5>
        </div>
        <div class="card-body">
            <div class="form-group">
                <label>F.I.SH. <span class="text-danger">*</span></label>
                <input type="text" class="form-control" name="FullName" required />
            </div>

            <div class="form-group">
                <label>JSHSHIR (14 ta raqam)</label>
                <input type="text" class="form-control" name="PINF" maxlength="14" pattern="[0-9]{14}"
                       placeholder="Masalan: 12345678901234" />
            </div>

            <div class="form-group">
                <label>Passport fayl (PDF yoki rasm)</label>
                <div class="custom-file">
                    <input type="file" class="custom-file-input" name="PassportFileUpload" id="PassportFileUpload" accept=".pdf,.jpg,.png" />
                    <label class="custom-file-label" for="PassportFileUpload">Faylni tanlang</label>
                </div>
            </div>

            <div class="form-group">
                <label>Viloyat <span class="text-danger">*</span></label>
                <select class="form-control" name="RegionId" id="Regions" required>
                    <option value="">Tanlang</option>
                </select>
            </div>

            <div class="form-group">
                <label>Tuman <span class="text-danger">*</span></label>
                <select class="form-control" name="DistrictId" id="Districts" required>
                    <option value="">Avval viloyatni tanlang</option>
                </select>
            </div>

            <div class="form-group">
                <label>Yashash manzili <span class="text-danger">*</span></label>
                <input type="text" class="form-control" name="Adress" required />
            </div>

            <div class="form-group">
                <label>Telefon raqami <span class="text-danger">*</span></label>
                <input type="text" class="form-control" name="PhoneNumber" id="phone" required />
            </div>

            <div class="form-group">
                <label>Email</label>
                <input type="email" class="form-control" name="Email" />
            </div>
        </div>
    </div>

    <div class="card mt-3">
        <div class="card-header bg-primary text-white">
            <h5>Xorijiy davlatlarda ta'lim olganlik to'g'risidagi ma'lumotlar</h5>
        </div>
        <div class="card-body">
            <div class="form-group">
                <label>Davlat <span class="text-danger">*</span></label>
                <select class="form-control" name="UniversityCountry" id="Countries" required>
                    <option value="">Tanlang</option>
                </select>
            </div>

            <div class="form-group">
                <label>Oliy ta'lim muassasasi nomi <span class="text-danger">*</span></label>
                <input type="text" class="form-control" name="UniversityName" required />
            </div>

            <div class="form-group">
                <label>Ta'lim bosqichi <span class="text-danger">*</span></label>
                <select class="form-control" name="StudyStepId" id="StudySteps" required>
                    <option value="">Tanlang</option>
                </select>
            </div>

            <div class="form-group">
                <label>Ta'lim shakli <span class="text-danger">*</span></label>
                <select class="form-control" name="StudyTypeId" id="StudyTypes" required>
                    <option value="">Tanlang</option>
                </select>
            </div>

            <div class="form-group">
                <label>Diplom seriyasi</label>
                <input type="text" class="form-control" name="DiplomSeria" />
            </div>

            <div class="form-group">
                <label>Diplom raqami <span class="text-danger">*</span></label>
                <input type="text" class="form-control" name="DiplomNumber" required />
            </div>

            <div class="form-group">
                <label>Diplom berilgan sana <span class="text-danger">*</span></label>
                <input type="date" class="form-control" name="DiplomGetDate" required />
            </div>

            <div class="form-group">
                <label>O'qishga kirgan yili</label>
                <input type="text" class="form-control" name="StudyStartYear" placeholder="2020" />
            </div>

            <div class="form-group">
                <label>O'qishni tugatgan yili <span class="text-danger">*</span></label>
                <input type="text" class="form-control" name="StudyEndYear" placeholder="2024" required />
            </div>

            <div class="form-group">
                <label>Notarial tasdiqlangan tarjima (PDF)</label>
                <div class="custom-file">
                    <input type="file" class="custom-file-input" name="File1Upload" id="File1Upload" accept=".pdf" />
                    <label class="custom-file-label" for="File1Upload">Faylni tanlang</label>
                </div>
            </div>

            <div class="form-group">
                <label>Ta'lim olganlik hujjati (PDF)</label>
                <div class="custom-file">
                    <input type="file" class="custom-file-input" name="File2Upload" id="File2Upload" accept=".pdf" />
                    <label class="custom-file-label" for="File2Upload">Faylni tanlang</label>
                </div>
            </div>

            <div class="form-group">
                <label>Appostil hujjat (PDF)</label>
                <div class="custom-file">
                    <input type="file" class="custom-file-input" name="AppostilFileUpload" id="AppostilFileUpload" accept=".pdf" />
                    <label class="custom-file-label" for="AppostilFileUpload">Faylni tanlang</label>
                </div>
            </div>
        </div>
    </div>

    <div class="mt-3 mb-5">
        <button type="submit" class="btn btn-success btn-lg">Arizani yuborish</button>
        <a href="/" class="btn btn-secondary btn-lg">Bekor qilish</a>
    </div>
}

@section Scripts {
    <script src="~/Scripts/jquery.inputmask.js"></script>
    <script>
        $(document).ready(function () {
            console.log("Script started");

            // Custom file input
            bsCustomFileInput.init();

            // Telefon raqam mask
            $("#phone").inputmask({ "mask": "+\\9\\98(99) 999-9999" });

            // Claimer type o'zgarganda parent name ko'rsatish
            $("#ClaimerTypeId").change(function () {
                if ($(this).val() == "4") {
                    $("#parentNameGroup").hide();
                } else {
                    $("#parentNameGroup").show();
                }
            });

            // Viloyatlarni yuklash
            console.log("Loading regions...");
            $.getJSON("/api/regions", function (result) {
                console.log("Regions loaded:", result);
                var $dropdown = $("#Regions");
                $dropdown.empty();
                $dropdown.append($("<option />").val("").text("Tanlang"));
                $.each(result, function () {
                    $dropdown.append($("<option />").val(this.id).text(this.nameUz));
                });
            }).fail(function(jqXHR, textStatus, errorThrown) {
                console.error("Error loading regions:", textStatus, errorThrown);
                alert("Viloyatlarni yuklashda xatolik yuz berdi!");
            });

            // Viloyat o'zgarganda tumanlarni yuklash
            $("#Regions").change(function () {
                var region = this.value;
                console.log("Region changed:", region);
                $('#Districts').empty().append($("<option />").val("").text("Tanlang"));

                if (region) {
                    $.getJSON("/Api/GetDistricts/" + region, function (result) {
                        console.log("Districts loaded:", result);
                        var $dropdown = $("#Districts");
                        $.each(result, function () {
                            $dropdown.append($("<option />").val(this.id).text(this.nameUz));
                        });
                    }).fail(function(jqXHR, textStatus, errorThrown) {
                        console.error("Error loading districts:", textStatus, errorThrown);
                    });
                }
            });

            // Davlatlarni yuklash
            $.getJSON("/Api/GetCountries", function (result) {
                console.log("Countries loaded:", result);
                var $dropdown = $("#Countries");
                $dropdown.empty();
                $dropdown.append($("<option />").val("").text("Tanlang"));
                $.each(result, function () {
                    $dropdown.append($("<option />").val(this.id).text(this.nameUz));
                });
            }).fail(function(jqXHR, textStatus, errorThrown) {
                console.error("Error loading countries:", textStatus, errorThrown);
            });

            // Ta'lim bosqichlarini yuklash
            $.getJSON("/GetApi/GetStudySteps", function (result) {
                console.log("Study steps loaded:", result);
                var $dropdown = $("#StudySteps");
                $dropdown.empty();
                $dropdown.append($("<option />").val("").text("Tanlang"));
                $.each(result, function () {
                    $dropdown.append($("<option />").val(this.id).text(this.name));
                });
            }).fail(function(jqXHR, textStatus, errorThrown) {
                console.error("Error loading study steps:", textStatus, errorThrown);
            });

            // Ta'lim shakllarini yuklash
            $.getJSON("/GetApi/GetStudyTypes", function (result) {
                console.log("Study types loaded:", result);
                var $dropdown = $("#StudyTypes");
                $dropdown.empty();
                $dropdown.append($("<option />").val("").text("Tanlang"));
                $.each(result, function () {
                    $dropdown.append($("<option />").val(this.id).text(this.name));
                });
            }).fail(function(jqXHR, textStatus, errorThrown) {
                console.error("Error loading study types:", textStatus, errorThrown);
            });
        });
    </script>
}